<!DOCTYPE html>
<!-- --------------- -------------------------------------------------------  -->
<!-- EasyServerPages example   ---------------------------------------------  -->
<!-- --------------- -------------------------------------------------------  -->
<html name="aExample" data-eezz-action="{'eezzAgent.assign':{'EasyTest/module.easytest/TDirView':{}}}">
<head>
    <style type="text/css">
        
        table.easyView {
            border          : 1px solid black;
            cursor          : pointer;
            vertical-align  : top;
            border-collapse : collapse;
            font-family     : "Times New Roman", Times, serif;
            font-size       : 12px;
            font-style      : italic;
        }
        
        table.easyView tbody {
            display   : block;
            overflow-x: auto;
            overflow  : auto;
        }
        
        table.TblDescription td {
            padding-left: 20px;
            padding-bottom: 10px;
            border: 0px solid black;
        }
        
        button {
            background-color: #ff9900;
        }
        
        body { 
            background-color:  white;
            background-image:  url('bg.png');
            background-attachment:fixed;
            background-size: 100% 100%;
            background-position:right top;        
            }
        
        hr.clHrThick {
            color: #e8662b; 
            height:5px; 
            border:1px inset silver; 
            margin-bottom: 0px;
            background-color:#e8662b
        }
        
        hr.clHrThin {
            color: #e8662b; 
            height:3px; 
            border:0px;
            margin-top: 4px;
            background-color:#e8662b
        }
        
    </style>

    <script data-eezz-action = "{'eezzAgent.dictionary':'eezzAgent.get_script'}">
        {websocket}
    </script>
    
</head>
            
<body name = "BodySection">
    
    <!-- The eezz header -------------------------------------------------------  -->
    <!-- --------------- -------------------------------------------------------  -->
    <table style="width:100%; ">
        <tr>
            <td style="width:5%"><hr class="clHrThick"/><hr class="clHrThin"/></td>
            <td style="width:0"><h1 style="color:#e8662b; white-space:nowrap">eezz master-detail view example</h1></td>
            <td style="width:75%"><hr class="clHrThick"/><hr class="clHrThin"/></td>
            <td style="width:0px"></td>
            <td style="width:5%"><hr class="clHrThick"/><hr class="clHrThin"/></td>
        </tr>
    </table>
    
    <table class="TblDescription">
        <tr>
            <td>
                <span style="font-size:24px;color: #e8662b">Faster:</span></td>
            <td style="font-weight:bold">Based on WEB-Sockets with minimal data transfer. Runs without JavaScript or CGI</td></tr>
        <tr>
            <td> <span style="font-size:24px;color: #e8662b">Magic:</span></td>
            <td style="font-weight:bold">Whatever you put into TTable would appear in HTML. The example below shows what's possible with ca. 30 lines of code.</td></tr>
        <tr>
            <td> <span style="font-size:24px;color: #e8662b">Easy:</span></td>
            <td style="font-weight:bold">TTable build in features include <ul><li>sorting</li><li>block and scroll navigation</li><li>command line output</li></ul></td></tr>
        <tr>
            <td>To run this example<br/>on command line:</td>
            <td>&gt; set PYTHONPATH=&lt;webroot&gt;\applications\EasyServerPage<br/>
                     &gt; cd &lt;webroot&gt;\applications\EasyTest\module<br/>
                     &gt; python easyTest.py</td></tr>
    </table>
    
    <!-- Content         -------------------------------------------------------  -->
    <!-- --------------- -------------------------------------------------------  -->
    <table style="margin-top:10pt; width:100%" class="easyTbl">   
        <tr>
            <td style="width:30%; height:150px; vertical-align:top">
                <!-- Directories     -------------------------------------------------------  -->
                <!-- --------------- -------------------------------------------------------  -->
                <table style="width:100%; height:100%" name="aDirList" class="easyView"
                    data-eezz-action = "{'eezzAgent.assign'   :{'aExample.get_selected_obj':{'index':'-1', 'visible_items':'40', 'visible_block':'10'}},
                                         'eezzAgent.dictionary':'aDirList.get_dictionary',
                                         'update': {'aFileList.innerHTML':'*', 'aDirList.innerHTML':'*', 'aEezzFile.value':'aDirList.data-cwd'} }"
                    data-cwd         = "{selected_entry}"
                    data-nav-prev    = "{table_prev}" 
                    data-nav-pos     = "{table_pos}" 
                    data-nav-next    = "{table_next}" 
                    data-nav-last    = "{table_last}" 
                    data-nav-top     = "{table_top}"
                    data-nav-current = "{table_current}">
                    <thead>
                        <tr data-eezz-template="{'table-rows':[':']}"> 
                            <th data-eezz-template="{'table-columns':['1:']}">{}</th></tr></thead> 
                    <tbody style="height:150pt">
                        <tr data-eezz-template="{'table-rows':[':']}"> 
                            <td data-eezz-template="{'table-columns':['1:']}"><img src="dir.ico"/>{}</td></tr></tbody>
                    <tfoot>
                        <tr data-eezz-template ="{'display':{'table_nav_type':'block'}}">
                            <td style="text-align:center">
                                <img src ="navbar.jpg" style="height:20px; width:160px" usemap="#aDirListNavMap"/>
                                    <map name="aDirListNavMap">
                                        <area shape="rect" coords="  0px, 0px,  40px, 20px" data-eezz-event="{'callback': {'aDirList.do_navigate': {'where':'aDirList.data-nav-top'}}, 'update'  : {'aDirList.innerHTML':'*'} }"/>                              
                                        <area shape="rect" coords=" 40px, 0px,  80px, 20px" data-eezz-event="{'callback': {'aDirList.do_navigate': {'where':'aDirList.data-nav-prev'}},'update'  : {'aDirList.innerHTML':'*'} }"/>
                                        <area shape="rect" coords=" 80px, 0px, 120px, 20px" data-eezz-event="{'callback': {'aDirList.do_navigate': {'where':'aDirList.data-nav-next'}},'update'  : {'aDirList.innerHTML':'*'} }"/>
                                        <area shape="rect" coords="120px, 0px, 160px, 20px" data-eezz-event="{'callback': {'aDirList.do_navigate': {'where':'aDirList.data-nav-last'}},'update'  : {'aDirList.innerHTML':'*'} }"/></map></td></tr></tfoot></table></td>
            <td rowspan="2" style="width:70%; vertical-align:top;">
<pre>
from easy.table import TTable
class TDirView(TTable):
    def __init__(self): 
        <span style="color:blue"># Define two TTable: master-detail
        super().__init__(['Directories'], 'directories')
        self.mDetail = TTable(['Files'], 'files')</span>
        self.mCurrPath = os.getcwd()
        self.do_select()
        
    <span style="color:green"># Generated callback
    def do_select(self, index = -1):</span>
        super().do_select(index)
        xSelectedDir   =  self.select_row()[0]
        if xSelectedDir == '..':
            self.mCurrPath = os.path.split(self.mHeaderDic['selected_entry'])[0]
        else:
            self.mCurrPath = os.path.join(self.mHeaderDic['selected_entry'], self.select_row()[0])
        self.mWalk = next(os.walk(self.mCurrPath))
        self.mHeaderDic['selected_entry'] = self.mWalk[0]
            
        self.clear()
        self.append(['..'])
        for xFile in self.mWalk[1]:
            <span style="color:red">self.append([xFile])         # Add directories </span>

        self.mDetail.clear()
        for xFile in self.mWalk[2]:
            <span style="color:red">self.mDetail.append([xFile]) # Add files </span>

    <span style="color:green"># Called before update
    def get_selected_obj(self, index=-1, visible_items=None, visible_block=None):</span>
        <span style="color:red">if index == -1:                 # Called by HTML-table aDirView </span>
            super().get_selected_obj(index, visible_items, visible_block)
            return self
        <span style="color:red">else:                            # Called by HTML-table aFileView</span>
            self.mDetail.get_selected_obj(index, visible_items, visible_block)
            return self.mDetail
                  
                  </pre></td></tr>
        <tr>
            <td style="width:30%; height:300px; vertical-align:top">
            
                <!-- Files     -------------------------------------------------------  -->
                <!-- --------------- -------------------------------------------------------  -->
                <table style="width:100%; height:100%" name="aFileList" class="easyView"
                    data-eezz-action = "{'eezzAgent.assign'    :{'aDirList.get_selected_obj':{'index':'0', 'visible_items':'50', 'visible_block':'40'}},
                                         'eezzAgent.dictionary':'aFileList.get_dictionary',
                                         'update'              :{'aEezzFile.value':'aFileList.data-current-file', 'aFileList.innerHTML':'*'} }"
                        data-current-file = "{selected_entry}"
                        data-nav-prev     = "{table_prev}" 
                        data-nav-pos      = "{table_pos}" 
                        data-nav-next     = "{table_next}" 
                        data-nav-last     = "{table_last}" 
                        data-nav-top      = "{table_top}"
                        data-nav-current  = "{table_current}">
                                    
                    <thead>
                        <tr data-eezz-template="{'table-rows':[':']}"> 
                            <th data-eezz-template="{'table-columns':['1:']}">{}</th></tr></thead> 
    
                    <tbody style="height:300pt;width:300pt;">
                        <tr data-eezz-template="{'table-rows':[':']}"> 
                            <td data-eezz-template="{'table-columns':['1:']}">{}</td></tr></tbody>
                    
                    <tfoot>
                        <tr data-eezz-template ="{'display':{'table_nav_type':'block'}}">
                            <td style="text-align:center">
                                <img src ="navbar.jpg" style="height:20px; width:160px" usemap="#aFileListNavMap"/>
                                <map name="aFileListNavMap">
                                    <area shape="rect" coords="  0px, 0px,  40px, 20px" data-eezz-event="{'callback': {'aFileList.do_navigate': {'where':'aFileList.data-nav-top'}}, 'update'  : {'aFileList.innerHTML':'*'} }"/>                              
                                    <area shape="rect" coords=" 40px, 0px,  80px, 20px" data-eezz-event="{'callback': {'aFileList.do_navigate': {'where':'aFileList.data-nav-prev'}},'update'  : {'aFileList.innerHTML':'*'} }"/>
                                    <area shape="rect" coords=" 80px, 0px, 120px, 20px" data-eezz-event="{'callback': {'aFileList.do_navigate': {'where':'aFileList.data-nav-next'}},'update'  : {'aFileList.innerHTML':'*'} }"/>
                                    <area shape="rect" coords="120px, 0px, 160px, 20px" data-eezz-event="{'callback': {'aFileList.do_navigate': {'where':'aFileList.data-nav-last'}},'update'  : {'aFileList.innerHTML':'*'} }"/></map></td></tr></tfoot>
                </table>
            </td></tr>
        <tr>
              <td colspan="2"><input style="width:50%" name="aEezzFile" type="text" value="URI" readonly="readonly" /></td></tr>    
    </table>
    
    <!-- Texte Database  -------------------------------------------------------  -->
    <!-- --------------- -------------------------------------------------------  -->
    <table name="aTexteDB" data-eezz-template = "database">
        <tr data-eezz-template="{'display':{'type':400}}"> <td>_("Invalid Request: {0}")</td></tr>
        <tr data-eezz-template="{'display':{'type':601}}"> <td>_("601 - Json Parser Error at [{0}:{1}]: {2} = {3}")  </td></tr>
        <tr data-eezz-template="{'display':{'type':602}}"> <td>_("602 - Path not found    at [{0}:{1}]: {2}")  </td></tr>
        <tr data-eezz-template="{'display':{'type':605}}"> <td>_("605 - HTML Parser Error at [{0}:{1}]: {3} != {2}") </td></tr>
        <tr data-eezz-template="{'display':{'type':610}}"> <td>_("610 - Class/Method not found {0}:{1}")      </td></tr>
            
        <tr data-eezz-template="{'table-rows':[':']}">
            <td  data-eezz-template="{'table-columns':[':']}">{}</td></tr>

    </table>
    
</body1>
</html>
